<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de bord - Indicateurs de Santé</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.2.1/dist/chartjs-plugin-zoom.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);

            --primary-color: #667eea;
            --secondary-color: #f5576c;
            --accent-color: #4facfe;
            --success-color: #43e97b;

            --background-light: #f8fafc;
            --background-dark: #0f172a;
            --card-light: #ffffff;
            --card-dark: #1e293b;
            --text-light: #1e293b;
            --text-dark: #f1f5f9;
            --border-light: #e2e8f0;
            --border-dark: #334155;

            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);

            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background-light);
            color: var(--text-light);
            line-height: 1.6;
            transition: var(--transition);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
        }

        body.dark-mode {
            background: var(--background-dark);
            color: var(--text-dark);
        }

        .app-container {
            display: flex;
            flex: 1 0 auto;
            gap: 1.5rem;
            padding: 1.5rem;
        }

        .sidebar {
            width: 320px;
            background: var(--card-light);
            border: 1px solid var(--border-light);
            border-radius: 20px;
            padding: 2rem 1.5rem;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            position: sticky;
            top: 1.5rem;
            height: fit-content;
            max-height: calc(100vh - 3rem);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        body.dark-mode .sidebar {
            background: var(--card-dark);
            border-color: var(--border-dark);
        }

        .sidebar-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-light);
            position: relative;
        }

        body.dark-mode .sidebar-header {
            border-bottom-color: var(--border-dark);
        }

        .sidebar-header::before {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: var(--primary-gradient);
            border-radius: 1px;
        }

        .sidebar h2 {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .sidebar-subtitle {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 500;
        }

        .indicator-list {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) transparent;
        }

        .indicator-list::-webkit-scrollbar {
            width: 6px;
        }

        .indicator-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .indicator-list::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 3px;
        }

        .indicator-list li {
            margin-bottom: 0.5rem;
        }

        .indicator-list button {
            width: 100%;
            padding: 1rem 1.25rem;
            text-align: left;
            background: transparent;
            color: var(--text-light);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .indicator-list button {
            color: var(--text-dark);
        }

        .indicator-list button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-gradient);
            opacity: 0;
            transition: var(--transition);
            border-radius: 10px;
        }

        .indicator-list button:hover::before {
            opacity: 0.1;
        }

        .indicator-list button:hover {
            transform: translateX(4px);
            border-color: var(--primary-color);
        }

        .indicator-list button.active {
            background: var(--primary-gradient);
            color: white;
            transform: translateX(4px);
            box-shadow: var(--shadow-md);
        }

        .indicator-list button.active::before {
            opacity: 0;
        }

        .indicator-list button i {
            font-size: 1.125rem;
            min-width: 20px;
            position: relative;
            z-index: 1;
        }

        .indicator-list button span {
            position: relative;
            z-index: 1;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .dashboard-header {
            background: var(--card-light);
            border: 1px solid var(--border-light);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .dashboard-header {
            background: var(--card-dark);
            border-color: var(--border-dark);
        }

        .dashboard-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        .dashboard-header h1 {
            font-size: 2rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .dashboard-header p {
            font-size: 1rem;
            color: #64748b;
            font-weight: 500;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .filter-panel {
            background: var(--card-light);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            align-items: end;
        }

        body.dark-mode .filter-panel {
            background: var(--card-dark);
            border-color: var(--border-dark);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 180px;
            gap: 0.5rem;
        }

        .filter-group label {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-light);
        }

        body.dark-mode .filter-group label {
            color: var(--text-dark);
        }

        .filter-group select {
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-light);
            border-radius: 10px;
            background: var(--card-light);
            color: var(--text-light);
            font-family: inherit;
            font-size: 0.875rem;
            font-weight: 500;
            transition: var(--transition);
            cursor: pointer;
        }

        body.dark-mode .filter-group select {
            background: var(--card-dark);
            border-color: var(--border-dark);
            color: var(--text-dark);
        }

        .filter-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgb(102 126 234 / 0.1);
        }

        .action-button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            background: var(--primary-gradient);
            color: white;
            font-family: inherit;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .action-button:active {
            transform: translateY(0);
        }

        .action-button.secondary {
            background: var(--secondary-gradient);
        }

        .action-button.success {
            background: var(--success-gradient);
        }

        .action-button i {
            font-size: 1rem;
        }

        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: var(--card-light);
            border: 1px solid var(--border-light);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            position: relative;
            overflow: visible;
        }

        body.dark-mode .card {
            background: var(--card-dark);
            border-color: var(--border-dark);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .card.selected {
            border: 3px solid var(--primary-color);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2), var(--shadow-xl);
            transform: translateY(-6px);
        }

        .card.selected::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--primary-gradient);
            z-index: 1;
        }

        .card.selected .card-header::after {
            background: var(--primary-gradient);
            width: 100px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-light);
            position: relative;
        }

        body.dark-mode .card-header {
            border-bottom-color: var(--border-dark);
        }

        .card-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 60px;
            height: 2px;
            background: var(--primary-gradient);
            border-radius: 1px;
            transition: var(--transition);
        }

        .card h2 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-light);
            margin: 0;
        }

        body.dark-mode .card h2 {
            color: var(--text-dark);
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            box-shadow: var(--shadow-md);
        }

        .tooltip {
            position: relative;
            cursor: help;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            z-index: 9999;
            width: 400px;
            max-width: 90vw;
            background: #1e293b;
            color: white;
            text-align: left;
            border-radius: 12px;
            padding: 1.5rem;
            font-size: 0.875rem;
            line-height: 1.6;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid #334155;
            word-wrap: break-word;
            hyphens: auto;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

            bottom: 100%;
            left: 0;
            margin-bottom: 15px;
            transform: translateY(10px);
        }

        body.dark-mode .tooltip .tooltiptext {
            background: white;
            color: #1e293b;
            border-color: #e2e8f0;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        .tooltip .tooltiptext::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 30px;
            border-width: 10px;
            border-style: solid;
            border-color: #1e293b transparent transparent transparent;
        }

        body.dark-mode .tooltip .tooltiptext::after {
            border-color: white transparent transparent transparent;
        }

        @media (max-width: 768px) {
            .tooltip .tooltiptext {
                width: 320px;
                font-size: 0.8rem;
                padding: 1.2rem;
                left: -50px;
            }

            .tooltip .tooltiptext::after {
                left: 80px;
            }
        }

        @media (max-width: 480px) {
            .tooltip .tooltiptext {
                width: 280px;
                left: -80px;
            }

            .tooltip .tooltiptext::after {
                left: 110px;
            }
        }

        .chart-container {
            position: relative;
            height: 320px;
            width: 100%;
            padding: 1rem;
            background: linear-gradient(145deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            margin-bottom: 1rem;
        }

        body.dark-mode .chart-container {
            background: linear-gradient(145deg, #1e293b 0%, #334155 100%);
        }

        .source-info {
            font-size: 0.75rem;
            color: #64748b;
            text-align: right;
            font-style: italic;
            padding: 0.5rem 0;
            border-top: 1px solid var(--border-light);
        }

        body.dark-mode .source-info {
            color: #94a3b8;
            border-top-color: var(--border-dark);
        }

        .highlight {
            animation: highlightAnimation 2s ease-in-out;
        }

        @keyframes highlightAnimation {

            0%,
            100% {
                border-color: var(--border-light);
                box-shadow: var(--shadow-md);
            }

            50% {
                border-color: var(--primary-color);
                box-shadow: 0 0 0 4px rgb(102 126 234 / 0.2), var(--shadow-lg);
            }
        }

        .footer {
            background: var(--card-light);
            border: 1px solid var(--border-light);
            border-radius: 20px 20px 0 0;
            padding: 2rem;
            text-align: center;
            margin-top: 2rem;
            box-shadow: var(--shadow-lg);
        }

        body.dark-mode .footer {
            background: var(--card-dark);
            border-color: var(--border-dark);
        }

        .footer .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
        }

        .footer img {
            height: 48px;
            filter: drop-shadow(0 2px 4px rgb(0 0 0 / 0.1));
        }

        .footer p {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 500;
        }

        .fade-in {
            animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: #64748b;
        }

        .loading::after {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 0.5rem;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        #language-select {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: var(--card-light);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            min-width: 150px;
            z-index: 1000;
        }

        body.dark-mode #language-select {
            background: var(--card-dark);
            border-color: var(--border-dark);
        }

        #language-select option {
            padding: 0.75rem 1rem;
        }

        .language-dropdown {
            position: relative;
        }

        @media (max-width: 1200px) {
            .indicators-grid {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            }

            .tooltip .tooltiptext {
                width: 300px;
            }
        }

        @media (max-width: 992px) {
            .app-container {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .sidebar {
                width: 100%;
                position: static;
                max-height: none;
                height: auto;
            }

            .indicator-list {
                max-height: 300px;
            }

            .dashboard-header {
                flex-direction: column;
                gap: 1.5rem;
                text-align: center;
            }

            .button-group {
                flex-wrap: wrap;
                justify-content: center;
            }

            .filter-panel {
                flex-direction: column;
                gap: 1rem;
            }

            .filter-group {
                min-width: 100%;
            }

            .tooltip .tooltiptext {
                width: 280px;
                position: absolute;
                left: 50%;
                transform: translateX(-50%) translateY(10px);
            }

            .tooltip:hover .tooltiptext {
                transform: translateX(-50%) translateY(0);
            }
        }

        @media (max-width: 768px) {
            .indicators-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 280px;
            }

            .dashboard-header h1 {
                font-size: 1.5rem;
            }

            .card {
                padding: 1rem;
            }

            .sidebar {
                padding: 1.5rem 1rem;
            }

            .tooltip .tooltiptext {
                width: 250px;
                font-size: 0.8rem;
                padding: 1rem;
            }
        }
    </style>
</head>

<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2 id="sidebar-title">Indicateurs de Santé</h2>
                <p class="sidebar-subtitle" id="sidebar-subtitle">Tableau de bord interactif</p>
            </div>
            <ul class="indicator-list" id="indicator-list">
                <!-- Les indicateurs seront générés dynamiquement -->
            </ul>
        </aside>

        <main class="main-content">
            <header class="dashboard-header fade-in">
                <div>
                    <h1 id="dashboard-title">Tableau de bord des indicateurs de santé</h1>
                    <p id="dashboard-subtitle">Comparaison entre Maroc, Région MENA et Monde</p>
                </div>
                <div class="button-group">
                    <button class="action-button success" id="export-button" onclick="exportData()">
                        <i class="fas fa-file-export"></i>
                        <span id="export-button-text">Exporter Excel</span>
                    </button>
                    <button class="action-button secondary" id="dark-mode-button" onclick="toggleDarkMode()">
                        <i class="fas fa-moon"></i>
                        <span id="dark-mode-button-text">Mode Sombre</span>
                    </button>
                    <div class="language-dropdown">
                        <button class="action-button" id="language-button" onclick="toggleLanguageDropdown()">
                            <i class="fas fa-globe"></i>
                            <span id="language-button-text">Langue</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <select id="language-select" onchange="changeLanguage()" style="display: none;">
                            <option value="fr">Français</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>
            </header>

            <div class="filter-panel fade-in">
                <div class="filter-group">
                    <label for="region-filter" id="region-filter-label">Région</label>
                    <select id="region-filter" onchange="applyFilters()">
                        <option value="all">Toutes les régions</option>
                        <option value="morocco">Maroc</option>
                        <option value="mena">Région MENA</option>
                        <option value="world">Monde</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="year-filter" id="year-filter-label">Année</label>
                    <select id="year-filter" onchange="applyFilters()">
                        <option value="all">Toutes les années</option>
                        <option value="2020">2020</option>
                        <option value="2021">2021</option>
                        <option value="2022">2022</option>
                        <option value="2023">2023</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="gender-filter" id="gender-filter-label">Genre</label>
                    <select id="gender-filter" onchange="applyFilters()">
                        <option value="all">Tous</option>
                        <option value="male">Hommes</option>
                        <option value="female">Femmes</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="category-filter" id="category-filter-label">Catégorie</label>
                    <select id="category-filter" onchange="applyFilters()">
                        <option value="all">Toutes</option>
                        <option value="mortality">Mortalité</option>
                        <option value="health-access">Accès à la santé</option>
                        <option value="population">Population</option>
                    </select>
                </div>
            </div>

            <div class="indicators-grid" id="indicators-container"></div>
        </main>
    </div>

    <footer class="footer">
        <div class="container">
            <img src="https://decisiveai.ma/wp-content/uploads/2024/12/Logo-Decisive-AI-PNG.png" alt="Decisive AI Logo">
            <p id="footer-text">© 2025 DecisiveAI. Tous droits réservés.</p>
        </div>
    </footer>

    <script>
        let chartInstances = {};
        let currentData = {};
        let isDarkMode = false;
        let currentLanguage = 'fr';
        let selectedIndicator = 'SP.DYN.LE00.IN';

        const indicators = {
            'SP.DYN.LE00.IN': { file: 'API_SP.DYN.LE00.IN_DS2_en_excel_v2_131999.xls', icon: 'fas fa-heartbeat', category: 'mortality' },
            'SP.DYN.LE00.MA.IN': { file: 'API_SP.DYN.LE00.MA.IN_DS2_en_excel_v2_86009.xls', icon: 'fas fa-mars', category: 'mortality' },
            'SP.DYN.LE00.FE.IN': { file: 'API_SP.DYN.LE00.FE.IN_DS2_en_excel_v2_86002.xls', icon: 'fas fa-venus', category: 'mortality' },
            'SP.DYN.AMRT.FE': { file: 'API_SP.DYN.AMRT.FE_DS2_en_excel_v2_131990.xls', icon: 'fas fa-venus', category: 'mortality' },
            'SP.DYN.AMRT.MA': { file: 'API_SP.DYN.AMRT.MA_DS2_en_excel_v2_85977.xls', icon: 'fas fa-mars', category: 'mortality' },
            'SP.DYN.CBRT.IN': { file: 'API_SP.DYN.CBRT.IN_DS2_en_excel_v2_85453.xls', icon: 'fas fa-birthday-cake', category: 'population' },
            'SP.DYN.CDRT.IN': { file: 'API_SP.DYN.CDRT.IN_DS2_en_excel_v2_85364.xls', icon: 'fas fa-skull', category: 'mortality' },
            'SP.DYN.TO65.FE.ZS': { file: 'API_SP.DYN.TO65.FE.ZS_DS2_en_excel_v2_86015.xls', icon: 'fas fa-venus', category: 'population' },
            'SP.DYN.TO65.MA.ZS': { file: 'API_SP.DYN.TO65.MA.ZS_DS2_en_excel_v2_86020.xls', icon: 'fas fa-mars', category: 'population' },
            'SH.STA.BASS.ZS': { file: 'API_SH.STA.BASS.ZS_DS2_en_excel_v2_93606.xls', icon: 'fas fa-toilet', category: 'health-access' },
            'SP.ADO.TFRT': { file: 'SP.ADO.TFRT.xlsx', icon: 'fas fa-baby', category: 'population' }
        };

        function getGenderFromFilename(filename) {
            if (filename.includes('.MA.') || filename.includes('.MA_')) return 'male';
            if (filename.includes('.FE.') || filename.includes('.FE_')) return 'female';
            return 'all';
        }

        Object.keys(indicators).forEach(key => {
            indicators[key].gender = getGenderFromFilename(indicators[key].file);
        });

        const translations = {
            en: {
                sidebarTitle: 'Health Indicators',
                sidebarSubtitle: 'Interactive Dashboard',
                dashboardTitle: 'Health Indicators Dashboard',
                dashboardSubtitle: 'Comparison between Morocco, MENA Region, and World',
                exportButton: 'Export to Excel',
                darkModeButton: 'Dark Mode',
                languageButton: 'Language',
                chartTitle: 'Evolution of ',
                indicatorDefinitionError: 'Error loading data: ',
                exportAlert: 'No data to export for the selected indicator.',
                exportError: 'Error exporting data: ',
                yearLabel: 'Year',
                regionLabel: 'Region',
                regionAll: 'All Regions',
                regionMorocco: 'Morocco',
                regionMena: 'MENA Region',
                regionWorld: 'World',
                genderFilterLabel: 'Gender',
                genderAll: 'All',
                genderMale: 'Male',
                genderFemale: 'Female',
                categoryLabel: 'Category',
                categoryAll: 'All',
                categoryMortality: 'Mortality',
                categoryHealthAccess: 'Health Access',
                categoryPopulation: 'Population',
                yearAll: 'All Years',
                footerText: '© 2025 DecisiveAI. All rights reserved.',
                sourceText: 'Source: The World Bank | Last Update: 04/15/2025',
                'SP.DYN.LE00.IN': 'Life expectancy at birth, total (years)',
                'SP.DYN.LE00.MA.IN': 'Life expectancy at birth, male (years)',
                'SP.DYN.LE00.FE.IN': 'Life expectancy at birth, female (years)',
                'SP.DYN.AMRT.FE': 'Adult mortality rate, female (per 1,000 female adults)',
                'SP.DYN.AMRT.MA': 'Adult mortality rate, male (per 1,000 male adults)',
                'SP.DYN.CBRT.IN': 'Crude birth rate (per 1,000 people)',
                'SP.DYN.CDRT.IN': 'Crude death rate (per 1,000 people)',
                'SP.DYN.TO65.FE.ZS': 'Population ages 65 and above, female (% of female population)',
                'SP.DYN.TO65.MA.ZS': 'Population ages 65 and above, male (% of male population)',
                'SH.STA.BASS.ZS': 'People using at least basic sanitation services (% of population)',
                'SP.ADO.TFRT': 'Adolescent fertility rate (births per 1,000 women ages 15-19)',
                'def_SP.DYN.LE00.IN': 'Life expectancy at birth indicates the number of years a newborn infant would live if prevailing patterns of mortality at the time of its birth were to stay the same throughout its life.',
                'def_SP.DYN.LE00.MA.IN': 'Life expectancy at birth indicates the number of years a newborn male infant would live if prevailing patterns of mortality at the time of its birth were to stay the same throughout its life.',
                'def_SP.DYN.LE00.FE.IN': 'Life expectancy at birth indicates the number of years a newborn female infant would live if prevailing patterns of mortality at the time of its birth were to stay the same throughout its life.',
                'def_SP.DYN.AMRT.FE': 'Adult mortality rate, female, is the probability of dying between the ages of 15 and 60--that is, the probability of a 15-year-old female dying before reaching age 60, if subject to current age-specific mortality rates between those ages.',
                'def_SP.DYN.AMRT.MA': 'Adult mortality rate, male, is the probability of dying between the ages of 15 and 60--that is, the probability of a 15-year-old male dying before reaching age 60, if subject to current age-specific mortality rates between those ages.',
                'def_SP.DYN.CBRT.IN': 'Crude birth rate indicates the number of live births occurring during the year, per 1,000 population estimated at midyear.',
                'def_SP.DYN.CDRT.IN': 'Crude death rate indicates the number of deaths occurring during the year, per 1,000 population estimated at midyear.',
                'def_SP.DYN.TO65.FE.ZS': 'Female population between the ages 65 to 69, 70 to 74, 75 to 79, 80 and above as a percentage of the total female population.',
                'def_SP.DYN.TO65.MA.ZS': 'Male population between the ages 65 to 69, 70 to 74, 75 to 79, 80 and above as a percentage of the total male population.',
                'def_SH.STA.BASS.ZS': 'The percentage of people using at least basic sanitation services, that is, improved sanitation facilities that are not shared with other households.',
                'def_SP.ADO.TFRT': 'Adolescent fertility rate is the number of births per 1,000 women ages 15-19.'
            },
            fr: {
                sidebarTitle: 'Indicateurs de Santé',
                sidebarSubtitle: 'Tableau de bord interactif',
                dashboardTitle: 'Tableau de bord des indicateurs de santé',
                dashboardSubtitle: 'Comparaison entre Maroc, Région MENA et Monde',
                exportButton: 'Exporter Excel',
                darkModeButton: 'Mode Sombre',
                languageButton: 'Langue',
                chartTitle: 'Évolution de ',
                indicatorDefinitionError: 'Erreur lors du chargement des données : ',
                exportAlert: 'Aucune donnée à exporter pour l\'indicateur sélectionné.',
                exportError: 'Erreur lors de l\'exportation des données : ',
                yearLabel: 'Année',
                regionLabel: 'Région',
                regionAll: 'Toutes les régions',
                regionMorocco: 'Maroc',
                regionMena: 'Région MENA',
                regionWorld: 'Monde',
                genderFilterLabel: 'Genre',
                genderAll: 'Tous',
                genderMale: 'Hommes',
                genderFemale: 'Femmes',
                categoryLabel: 'Catégorie',
                categoryAll: 'Toutes',
                categoryMortality: 'Mortalité',
                categoryHealthAccess: 'Accès à la santé',
                categoryPopulation: 'Population',
                yearAll: 'Toutes les années',
                footerText: '© 2025 DecisiveAI. Tous droits réservés.',
                sourceText: 'Source : La Banque Mondiale | Mise à jour : 15/04/2025',
                'SP.DYN.LE00.IN': 'Espérance de vie à la naissance, total (années)',
                'SP.DYN.LE00.MA.IN': 'Espérance de vie à la naissance, hommes (années)',
                'SP.DYN.LE00.FE.IN': 'Espérance de vie à la naissance, femmes (années)',
                'SP.DYN.AMRT.FE': 'Taux de mortalité adulte, femmes (pour 1 000 femmes adultes)',
                'SP.DYN.AMRT.MA': 'Taux de mortalité adulte, hommes (pour 1 000 hommes adultes)',
                'SP.DYN.CBRT.IN': 'Taux brut de natalité (pour 1 000 habitants)',
                'SP.DYN.CDRT.IN': 'Taux brut de mortalité (pour 1 000 habitants)',
                'SP.DYN.TO65.FE.ZS': 'Population féminine de 65 ans et plus (% de la population féminine)',
                'SP.DYN.TO65.MA.ZS': 'Population masculine de 65 ans et plus (% de la population masculine)',
                'SH.STA.BASS.ZS': 'Population utilisant au moins des services d\'assainissement de base (%)',
                'SP.ADO.TFRT': 'Taux de fécondité des adolescentes (naissances pour 1 000 femmes âgées de 15 à 19 ans)',
                'def_SP.DYN.LE00.IN': 'L\'espérance de vie à la naissance indique le nombre d\'années qu\'un nouveau-né vivrait si les modèles de mortalité actuels au moment de sa naissance restaient les mêmes tout au long de sa vie.',
                'def_SP.DYN.LE00.MA.IN': 'L\'espérance de vie à la naissance indique le nombre d\'années qu\'un nouveau-né de sexe masculin vivrait si les modèles de mortalité actuels au moment de sa naissance restaient les mêmes tout au long de sa vie.',
                'def_SP.DYN.LE00.FE.IN': 'L\'espérance de vie à la naissance indique le nombre d\'années qu\'un nouveau-né de sexe féminin vivrait si les modèles de mortalité actuels au moment de sa naissance restaient les mêmes tout au long de sa vie.',
                'def_SP.DYN.AMRT.FE': 'Le taux de mortalité adulte, femmes, est la probabilité de mourir entre 15 et 60 ans, c\'est-à-dire la probabilité qu\'une femme de 15 ans meure avant d\'atteindre 60 ans, si elle est soumise aux taux de mortalité actuels spécifiques à l\'âge entre ces âges.',
                'def_SP.DYN.AMRT.MA': 'Le taux de mortalité adulte, hommes, est la probabilité de mourir entre 15 et 60 ans, c\'est-à-dire la probabilité qu\'un homme de 15 ans meure avant d\'atteindre 60 ans, s\'il est soumis aux taux de mortalité actuels spécifiques à l\'âge entre ces âges.',
                'def_SP.DYN.CBRT.IN': 'Le taux brut de natalité indique le nombre de naissances vivantes survenant au cours de l\'année, pour 1 000 habitants estimés à la mi-année.',
                'def_SP.DYN.CDRT.IN': 'Le taux brut de mortalité indique le nombre de décès survenant au cours de l\'année, pour 1 000 habitants estimés à la mi-année.',
                'def_SP.DYN.TO65.FE.ZS': 'Population féminine entre les âges de 65 à 69, 70 à 74, 75 à 79, 80 ans et plus en pourcentage de la population féminine totale.',
                'def_SP.DYN.TO65.MA.ZS': 'Population masculine entre les âges de 65 à 69, 70 à 74, 75 à 79, 80 ans et plus en pourcentage de la population masculine totale.',
                'def_SH.STA.BASS.ZS': 'Le pourcentage de personnes utilisant au moins des services d\'assainissement de base, c\'est-à-dire des installations d\'assainissement améliorées qui ne sont pas partagées avec d\'autres ménages.',
                'def_SP.ADO.TFRT': 'Le taux de fécondité des adolescentes est le nombre de naissances pour 1 000 femmes âgées de 15 à 19 ans.'
            }
        };

        function generateIndicatorList() {
            const indicatorList = document.getElementById('indicator-list');
            indicatorList.innerHTML = '';

            let isFirst = true;
            Object.keys(indicators).forEach(indicatorKey => {
                const indicator = indicators[indicatorKey];
                const li = document.createElement('li');
                li.innerHTML = `
                    <button data-indicator="${indicatorKey}" ${isFirst ? 'class="active"' : ''}>
                        <i class="${indicator.icon}"></i>
                        <span id="indicator-${indicatorKey}">${translations[currentLanguage][indicatorKey]}</span>
                    </button>
                `;
                indicatorList.appendChild(li);
                isFirst = false;
            });
        }

        function toggleLanguageDropdown() {
            const dropdown = document.getElementById('language-select');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        function changeLanguage() {
            currentLanguage = document.getElementById('language-select').value;
            updateLanguage();
            generateIndicatorList();
            Object.keys(indicators).forEach(indicatorKey => {
                if (currentData[indicatorKey]) {
                    updateChart(indicatorKey, currentData[indicatorKey].years, currentData[indicatorKey].marocData, currentData[indicatorKey].menaData, currentData[indicatorKey].worldData, indicators[indicatorKey]);
                }
            });
        }

        function updateLanguage() {
            const t = translations[currentLanguage];
            document.documentElement.lang = currentLanguage;
            document.getElementById('sidebar-title').textContent = t.sidebarTitle;
            document.getElementById('sidebar-subtitle').textContent = t.sidebarSubtitle;
            document.getElementById('dashboard-title').textContent = t.dashboardTitle;
            document.getElementById('dashboard-subtitle').textContent = t.dashboardSubtitle;
            document.getElementById('export-button-text').textContent = t.exportButton;
            document.getElementById('dark-mode-button-text').textContent = t.darkModeButton;
            document.getElementById('language-button-text').textContent = t.languageButton;
            document.getElementById('region-filter-label').textContent = t.regionLabel;
            document.getElementById('year-filter-label').textContent = t.yearLabel;
            document.getElementById('gender-filter-label').textContent = t.genderFilterLabel;
            document.getElementById('category-filter-label').textContent = t.categoryLabel;
            document.getElementById('footer-text').textContent = t.footerText;

            const regionFilter = document.getElementById('region-filter');
            regionFilter.innerHTML = `
                <option value="all">${t.regionAll}</option>
                <option value="morocco">${t.regionMorocco}</option>
                <option value="mena">${t.regionMena}</option>
                <option value="world">${t.regionWorld}</option>
            `;

            const yearFilter = document.getElementById('year-filter');
            yearFilter.innerHTML = `
                <option value="all">${t.yearAll}</option>
                <option value="2020">2020</option>
                <option value="2021">2021</option>
                <option value="2022">2022</option>
                <option value="2023">2023</option>
            `;

            const genderFilter = document.getElementById('gender-filter');
            genderFilter.innerHTML = `
                <option value="all">${t.genderAll}</option>
                <option value="male">${t.genderMale}</option>
                <option value="female">${t.genderFemale}</option>
            `;

            const categoryFilter = document.getElementById('category-filter');
            categoryFilter.innerHTML = `
                <option value="all">${t.categoryAll}</option>
                <option value="mortality">${t.categoryMortality}</option>
                <option value="health-access">${t.categoryHealthAccess}</option>
                <option value="population">${t.categoryPopulation}</option>
            `;

            Object.keys(indicators).forEach(indicatorKey => {
                const card = document.getElementById(`card-${indicatorKey}`);
                if (card) {
                    const title = card.querySelector('h2');
                    title.textContent = t[indicatorKey];
                    const tooltip = document.getElementById(`tooltip-${indicatorKey}`);
                    if (tooltip) tooltip.textContent = t[`def_${indicatorKey}`];
                    const source = document.getElementById(`source-${indicatorKey}`);
                    if (source) source.textContent = t.sourceText;
                }
            });
        }

        function updateSelectedIndicator(indicatorKey) {
            selectedIndicator = indicatorKey;

            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('selected');
            });

            const selectedCard = document.getElementById(`card-${indicatorKey}`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }
        }

        async function loadIndicatorData(indicatorKey) {
            const indicator = indicators[indicatorKey];
            const container = document.getElementById('indicators-container');

            if (!document.getElementById(`card-${indicatorKey}`)) {
                const card = document.createElement('div');
                card.className = `card fade-in ${indicatorKey === selectedIndicator ? 'selected' : ''}`;
                card.id = `card-${indicatorKey}`;
                card.innerHTML = `
                    <div class="card-header">
                        <div class="tooltip">
                            <h2>${translations[currentLanguage][indicatorKey]}</h2>
                            <span class="tooltiptext" id="tooltip-${indicatorKey}">${translations[currentLanguage][`def_${indicatorKey}`]}</span>
                        </div>
                        <div class="card-icon">
                            <i class="${indicator.icon}"></i>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div class="loading">Chargement des données...</div>
                    </div>
                    <div class="source-info" id="source-${indicatorKey}">${translations[currentLanguage].sourceText}</div>
                `;
                container.appendChild(card);
            }

            try {
                const response = await fetch(indicator.file);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                const dataSheet = workbook.Sheets['Data'];
                const dataJson = XLSX.utils.sheet_to_json(dataSheet);

                const menaCountries = ['DZA', 'BHR', 'EGY', 'IRN', 'IRQ', 'JOR', 'KWT', 'LBN', 'LBY', 'MAR', 'OMN', 'QAT', 'SAU', 'SYR', 'TUN', 'ARE', 'PSE', 'YEM'];
                const firstRow = dataJson[0] || {};
                const yearColumns = Object.keys(firstRow).filter(key => /^\d{4}$/.test(key)).sort((a, b) => b - a);

                let latestYear = null;
                for (let year of yearColumns) {
                    const marocRow = dataJson.find(row => row['Country Code'] === 'MAR');
                    const worldRow = dataJson.find(row => row['Country Code'] === 'WLD');
                    let menaHasData = false;

                    for (let country of menaCountries) {
                        const row = dataJson.find(row => row['Country Code'] === country);
                        if (row && row[year] && !isNaN(parseFloat(row[year])) && row[year] !== '') {
                            menaHasData = true;
                            break;
                        }
                    }

                    const marocHasData = marocRow && marocRow[year] && !isNaN(parseFloat(marocRow[year])) && marocRow[year] !== '';
                    const worldHasData = worldRow && worldRow[year] && !isNaN(parseFloat(worldRow[year])) && worldRow[year] !== '';

                    if (marocHasData && worldHasData && menaHasData) {
                        latestYear = year;
                        break;
                    }
                }

                if (!latestYear) {
                    latestYear = yearColumns[0];
                }

                const years = yearColumns.filter(year => parseInt(year) <= parseInt(latestYear)).slice(0, 4).reverse();

                let marocData = [], menaData = [], worldData = [];

                const marocRow = dataJson.find(row => row['Country Code'] === 'MAR');
                if (marocRow) {
                    years.forEach(year => {
                        marocData.push(marocRow[year] ? parseFloat(marocRow[year]).toFixed(2) : null);
                    });
                } else {
                    document.getElementById(`source-${indicatorKey}`).textContent = `Source: N/A | Mise à jour: N/A`;
                }

                const worldRow = dataJson.find(row => row['Country Code'] === 'WLD');
                if (worldRow) {
                    years.forEach(year => {
                        worldData.push(worldRow[year] ? parseFloat(worldRow[year]).toFixed(2) : null);
                    });
                }

                years.forEach(year => {
                    let sum = 0, count = 0;
                    menaCountries.forEach(country => {
                        const row = dataJson.find(row => row['Country Code'] === country);
                        if (row && row[year] && !isNaN(parseFloat(row[year]))) {
                            sum += parseFloat(row[year]);
                            count++;
                        }
                    });
                    menaData.push(count > 0 ? parseFloat((sum / count).toFixed(2)) : null);
                });

                currentData[indicatorKey] = { years, marocData, menaData, worldData };
                updateChart(indicatorKey, years, marocData, menaData, worldData, indicator);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById(`source-${indicatorKey}`).textContent = `Source: Erreur | Mise à jour: N/A`;
                const card = document.getElementById(`card-${indicatorKey}`);
                if (card) {
                    const chartContainer = card.querySelector('.chart-container');
                    chartContainer.innerHTML = `<p style="text-align: center; color: #ef4444; padding: 2rem;">${translations[currentLanguage].indicatorDefinitionError}${error.message}</p>`;
                }
            }
        }

        function updateChart(indicatorKey, years, marocData, menaData, worldData, indicator) {
            const chartContainer = document.getElementById(`card-${indicatorKey}`).querySelector('.chart-container');
            chartContainer.innerHTML = '<canvas id="chart-' + indicatorKey + '"></canvas>';

            const ctx = document.getElementById(`chart-${indicatorKey}`).getContext('2d');
            if (chartInstances[indicatorKey]) chartInstances[indicatorKey].destroy();

            const regionFilter = document.getElementById('region-filter').value;
            const yearFilter = document.getElementById('year-filter').value;
            const genderFilter = document.getElementById('gender-filter').value;
            const categoryFilter = document.getElementById('category-filter').value;

            if (categoryFilter !== 'all' && indicator.category !== categoryFilter) {
                document.getElementById(`card-${indicatorKey}`).style.display = 'none';
                return;
            } else {
                document.getElementById(`card-${indicatorKey}`).style.display = 'block';
            }

            if (genderFilter !== 'all' && indicator.gender !== genderFilter) {
                document.getElementById(`card-${indicatorKey}`).style.display = 'none';
                return;
            } else {
                document.getElementById(`card-${indicatorKey}`).style.display = 'block';
            }

            const datasets = [];
            if (regionFilter === 'all' || regionFilter === 'morocco') datasets.push({
                label: currentLanguage === 'fr' ? 'Maroc' : 'Morocco',
                data: marocData,
                borderColor: '#667eea',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointRadius: 6,
                pointBackgroundColor: '#667eea',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 3
            });
            if (regionFilter === 'all' || regionFilter === 'mena') datasets.push({
                label: currentLanguage === 'fr' ? 'Région MENA' : 'MENA Region',
                data: menaData,
                borderColor: '#f5576c',
                backgroundColor: 'rgba(245, 87, 108, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointRadius: 6,
                pointBackgroundColor: '#f5576c',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 3
            });
            if (regionFilter === 'all' || regionFilter === 'world') datasets.push({
                label: currentLanguage === 'fr' ? 'Monde' : 'World',
                data: worldData,
                borderColor: '#4facfe',
                backgroundColor: 'rgba(79, 172, 254, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointRadius: 6,
                pointBackgroundColor: '#4facfe',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 3
            });

            let filteredYears = years;
            let filteredData = datasets.map(dataset => ({ ...dataset, data: dataset.data.slice() }));

            if (yearFilter !== 'all') {
                const yearIndex = years.indexOf(yearFilter);
                filteredYears = [yearFilter];
                filteredData = datasets.map(dataset => ({
                    ...dataset,
                    data: [dataset.data[yearIndex]]
                }));
            }

            chartInstances[indicatorKey] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: filteredYears,
                    datasets: filteredData
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: translations[currentLanguage].chartTitle + translations[currentLanguage][indicatorKey],
                            align: 'center',
                            font: { size: 12, weight: '600' },
                            color: isDarkMode ? '#f1f5f9' : '#1e293b',
                            padding: { top: 10, bottom: 20 }
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 10, weight: '500' },
                                color: isDarkMode ? '#f1f5f9' : '#1e293b',
                                padding: 12,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleFont: { size: 12, weight: '600' },
                            bodyFont: { size: 11 },
                            padding: 12,
                            cornerRadius: 8,
                            usePointStyle: true,
                            callbacks: {
                                label: context => `${context.dataset.label}: ${context.parsed.y ? context.parsed.y.toFixed(2) : 'N/A'}`
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '',
                                font: { size: 10, weight: '500' },
                                color: isDarkMode ? '#f1f5f9' : '#1e293b'
                            },
                            grid: {
                                color: isDarkMode ? 'rgba(241, 245, 249, 0.1)' : 'rgba(30, 41, 59, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: isDarkMode ? '#94a3b8' : '#64748b',
                                font: { size: 9 },
                                callback: value => value ? value.toFixed(1) : 'N/A'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: translations[currentLanguage].yearLabel,
                                font: { size: 10, weight: '500' },
                                color: isDarkMode ? '#f1f5f9' : '#1e293b'
                            },
                            grid: { display: false },
                            ticks: {
                                color: isDarkMode ? '#94a3b8' : '#64748b',
                                font: { size: 9, weight: '500' }
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    },
                    layout: {
                        padding: {
                            top: 10,
                            bottom: 5,
                            left: 5,
                            right: 5
                        }
                    }
                }
            });
        }

        function applyFilters() {
            const regionFilter = document.getElementById('region-filter').value;
            const yearFilter = document.getElementById('year-filter').value;
            const genderFilter = document.getElementById('gender-filter').value;
            const categoryFilter = document.getElementById('category-filter').value;

            Object.keys(indicators).forEach(indicatorKey => {
                const card = document.getElementById(`card-${indicatorKey}`);
                if (card && currentData[indicatorKey]) {
                    const indicator = indicators[indicatorKey];
                    const { years, marocData, menaData, worldData } = currentData[indicatorKey];

                    if (categoryFilter !== 'all' && indicator.category !== categoryFilter) {
                        card.style.display = 'none';
                        return;
                    }

                    if (genderFilter !== 'all' && indicator.gender !== genderFilter) {
                        card.style.display = 'none';
                        return;
                    }

                    card.style.display = 'block';
                    updateChart(indicatorKey, years, marocData, menaData, worldData, indicator);
                }
            });
        }

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode');

            const darkModeIcon = document.getElementById('dark-mode-button').querySelector('i');
            darkModeIcon.className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
            document.getElementById('dark-mode-button-text').textContent = translations[currentLanguage].darkModeButton;

            Object.values(chartInstances).forEach(chart => {
                chart.options.scales.x.ticks.color = isDarkMode ? '#94a3b8' : '#64748b';
                chart.options.scales.y.ticks.color = isDarkMode ? '#94a3b8' : '#64748b';
                chart.options.plugins.legend.labels.color = isDarkMode ? '#f1f5f9' : '#1e293b';
                chart.options.scales.y.title.color = isDarkMode ? '#f1f5f9' : '#1e293b';
                chart.options.scales.x.title.color = isDarkMode ? '#f1f5f9' : '#1e293b';
                chart.options.plugins.title.color = isDarkMode ? '#f1f5f9' : '#1e293b';
                chart.options.scales.y.grid.color = isDarkMode ? 'rgba(241, 245, 249, 0.1)' : 'rgba(30, 41, 59, 0.1)';
                chart.update();
            });
        }

        function exportData() {
            if (!currentData[selectedIndicator]) {
                alert(translations[currentLanguage].exportAlert);
                return;
            }

            try {
                const data = currentData[selectedIndicator];
                console.log('Exporting data for indicator:', selectedIndicator, data);

                const exportData = data.years.map((year, index) => ({
                    [translations[currentLanguage].yearLabel]: year,
                    [currentLanguage === 'fr' ? 'Maroc' : 'Morocco']: data.marocData[index] || null,
                    [currentLanguage === 'fr' ? 'Région MENA' : 'MENA Region']: data.menaData[index] || null,
                    [currentLanguage === 'fr' ? 'Monde' : 'World']: data.worldData[index] || null
                }));

                const ws = XLSX.utils.json_to_sheet(exportData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, translations[currentLanguage][selectedIndicator].substring(0, 31));
                XLSX.writeFile(wb, `indicator_${selectedIndicator}_${new Date().toISOString().split('T')[0]}.xlsx`);
            } catch (error) {
                console.error('Export error:', error);
                alert(translations[currentLanguage].exportError + error.message);
            }
        }

        function setupIndicatorListeners() {
            document.querySelectorAll('.indicator-list li button').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.indicator-list button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    const indicatorKey = button.getAttribute('data-indicator');
                    updateSelectedIndicator(indicatorKey);

                    const card = document.getElementById(`card-${indicatorKey}`);
                    if (card) {
                        card.classList.add('highlight');
                        card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        setTimeout(() => {
                            card.classList.remove('highlight');
                        }, 2000);
                    }
                });
            });
        }

        document.addEventListener('click', (event) => {
            const languageDropdown = document.querySelector('.language-dropdown');
            const languageSelect = document.getElementById('language-select');
            if (!languageDropdown.contains(event.target)) {
                languageSelect.style.display = 'none';
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            generateIndicatorList();
            setupIndicatorListeners();
            updateLanguage();

            Object.keys(indicators).forEach((indicatorKey, index) => {
                setTimeout(() => {
                    loadIndicatorData(indicatorKey);
                }, index * 200);
            });

            setTimeout(() => {
                const cards = document.querySelectorAll('.card');
                cards.forEach((card, index) => {
                    card.style.animationDelay = `${index * 0.1}s`;
                });
            }, 500);
        });
    </script>
</body>

</html>