<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de bord - Indicateurs de Santé</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.2.1/dist/chartjs-plugin-zoom.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);

            --primary-color: #667eea;
            --secondary-color: #f5576c;
            --accent-color: #4facfe;
            --success-color: #43e97b;

            --background-light: #f8fafc;
            --background-dark: #0f172a;
            --card-light: #ffffff;
            --card-dark: #1e293b;
            --text-light: #1e293b;
            --text-dark: #f1f5f9;
            --border-light: #e2e8f0;
            --border-dark: #334155;

            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);

            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background-light);
            color: var(--text-light);
            line-height: 1.6;
            transition: var(--transition);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
        }

        body.dark-mode {
            background: var(--background-dark);
            color: var(--text-dark);
        }

        .app-container {
            display: flex;
            flex: 1 0 auto;
            gap: 1.5rem;
            padding: 1.5rem;
        }

        /* Sidebar améliorée */
        .sidebar {
            width: 320px;
            background: var(--card-light);
            border: 1px solid var(--border-light);
            border-radius: 20px;
            padding: 2rem 1.5rem;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            position: sticky;
            top: 1.5rem;
            height: fit-content;
            max-height: calc(100vh - 3rem);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        body.dark-mode .sidebar {
            background: var(--card-dark);
            border-color: var(--border-dark);
        }

        .sidebar-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-light);
            position: relative;
        }

        body.dark-mode .sidebar-header {
            border-bottom-color: var(--border-dark);
        }

        .sidebar-header::before {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: var(--primary-gradient);
            border-radius: 1px;
        }

        .sidebar h2 {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .sidebar-subtitle {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 500;
        }

        .indicator-list {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) transparent;
        }

        .indicator-list::-webkit-scrollbar {
            width: 6px;
        }

        .indicator-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .indicator-list::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 3px;
        }

        .indicator-list li {
            margin-bottom: 0.5rem;
        }

        .indicator-list button {
            width: 100%;
            padding: 1rem 1.25rem;
            text-align: left;
            background: transparent;
            color: var(--text-light);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .indicator-list button {
            color: var(--text-dark);
        }

        .indicator-list button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-gradient);
            opacity: 0;
            transition: var(--transition);
            border-radius: 10px;
        }

        .indicator-list button:hover::before {
            opacity: 0.1;
        }

        .indicator-list button:hover {
            transform: translateX(4px);
            border-color: var(--primary-color);
        }

        .indicator-list button.active {
            background: var(--primary-gradient);
            color: white;
            transform: translateX(4px);
            box-shadow: var(--shadow-md);
        }

        .indicator-list button.active::before {
            opacity: 0;
        }

        .indicator-list button i {
            font-size: 1.125rem;
            min-width: 20px;
            position: relative;
            z-index: 1;
        }

        .indicator-list button span {
            position: relative;
            z-index: 1;
        }

        /* Main content amélioré */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .dashboard-header {
            background: var(--card-light);
            border: 1px solid var(--border-light);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .dashboard-header {
            background: var(--card-dark);
            border-color: var(--border-dark);
        }

        .dashboard-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        .dashboard-header h1 {
            font-size: 2rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .dashboard-header p {
            font-size: 1rem;
            color: #64748b;
            font-weight: 500;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* Filtres améliorés */
        .filter-panel {
            background: var(--card-light);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            align-items: end;
        }

        body.dark-mode .filter-panel {
            background: var(--card-dark);
            border-color: var(--border-dark);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 180px;
            gap: 0.5rem;
        }

        .filter-group label {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-light);
        }

        body.dark-mode .filter-group label {
            color: var(--text-dark);
        }

        .filter-group select {
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-light);
            border-radius: 10px;
            background: var(--card-light);
            color: var(--text-light);
            font-family: inherit;
            font-size: 0.875rem;
            font-weight: 500;
            transition: var(--transition);
            cursor: pointer;
        }

        body.dark-mode .filter-group select {
            background: var(--card-dark);
            border-color: var(--border-dark);
            color: var(--text-dark);
        }

        .filter-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgb(102 126 234 / 0.1);
        }

        /* Boutons d'action améliorés */
        .action-button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            background: var(--primary-gradient);
            color: white;
            font-family: inherit;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .action-button:active {
            transform: translateY(0);
        }

        .action-button.secondary {
            background: var(--secondary-gradient);
        }

        .action-button.success {
            background: var(--success-gradient);
        }

        .action-button i {
            font-size: 1rem;
        }

        /* Grille d'indicateurs améliorée */
        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: var(--card-light);
            border: 1px solid var(--border-light);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            position: relative;
            overflow: visible;
            /* CHANGÉ: permet aux tooltips de déborder */
        }

        body.dark-mode .card {
            background: var(--card-dark);
            border-color: var(--border-dark);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        /* Indicateur sélectionné - mise en évidence */
        .card.selected {
            border: 3px solid var(--primary-color);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2), var(--shadow-xl);
            transform: translateY(-6px);
        }

        .card.selected::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--primary-gradient);
            z-index: 1;
        }

        .card.selected .card-header::after {
            background: var(--primary-gradient);
            width: 100px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-light);
            position: relative;
        }

        body.dark-mode .card-header {
            border-bottom-color: var(--border-dark);
        }

        .card-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 60px;
            height: 2px;
            background: var(--primary-gradient);
            border-radius: 1px;
            transition: var(--transition);
        }

        .card h2 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-light);
            margin: 0;
        }

        body.dark-mode .card h2 {
            color: var(--text-dark);
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            box-shadow: var(--shadow-md);
        }

        /* Tooltip CORRECTEMENT POSITIONNÉ - au-dessus du titre */
        .tooltip {
            position: relative;
            cursor: help;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            z-index: 9999;
            width: 400px;
            max-width: 90vw;
            background: #1e293b;
            color: white;
            text-align: left;
            border-radius: 12px;
            padding: 1.5rem;
            font-size: 0.875rem;
            line-height: 1.6;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid #334155;
            word-wrap: break-word;
            hyphens: auto;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

            /* POSITION FIXE : toujours au-dessus du titre */
            bottom: 100%;
            left: 0;
            margin-bottom: 15px;
            transform: translateY(10px);
        }

        body.dark-mode .tooltip .tooltiptext {
            background: white;
            color: #1e293b;
            border-color: #e2e8f0;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Flèche du tooltip - pointant vers le titre */
        .tooltip .tooltiptext::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 30px;
            border-width: 10px;
            border-style: solid;
            border-color: #1e293b transparent transparent transparent;
        }

        body.dark-mode .tooltip .tooltiptext::after {
            border-color: white transparent transparent transparent;
        }

        /* Ajustement pour mobile */
        @media (max-width: 768px) {
            .tooltip .tooltiptext {
                width: 320px;
                font-size: 0.8rem;
                padding: 1.2rem;
                left: -50px;
                /* Centrer un peu mieux sur mobile */
            }

            .tooltip .tooltiptext::after {
                left: 80px;
                /* Ajuster la position de la flèche */
            }
        }

        @media (max-width: 480px) {
            .tooltip .tooltiptext {
                width: 280px;
                left: -80px;
            }

            .tooltip .tooltiptext::after {
                left: 110px;
            }
        }

        /* Container de graphique amélioré */
        .chart-container {
            position: relative;
            height: 280px;
            width: 100%;
            padding: 1rem;
            background: linear-gradient(145deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            margin-bottom: 1rem;
        }

        body.dark-mode .chart-container {
            background: linear-gradient(145deg, #1e293b 0%, #334155 100%);
        }

        .source-info {
            font-size: 0.75rem;
            color: #64748b;
            text-align: right;
            font-style: italic;
            padding: 0.5rem 0;
            border-top: 1px solid var(--border-light);
        }

        body.dark-mode .source-info {
            color: #94a3b8;
            border-top-color: var(--border-dark);
        }

        /* Animation de mise en évidence */
        .highlight {
            animation: highlightAnimation 2s ease-in-out;
        }

        @keyframes highlightAnimation {

            0%,
            100% {
                border-color: var(--border-light);
                box-shadow: var(--shadow-md);
            }

            50% {
                border-color: var(--primary-color);
                box-shadow: 0 0 0 4px rgb(102 126 234 / 0.2), var(--shadow-lg);
            }
        }

        /* Footer amélioré */
        .footer {
            background: var(--card-light);
            border: 1px solid var(--border-light);
            border-radius: 20px 20px 0 0;
            padding: 2rem;
            text-align: center;
            margin-top: 2rem;
            box-shadow: var(--shadow-lg);
        }

        body.dark-mode .footer {
            background: var(--card-dark);
            border-color: var(--border-dark);
        }

        .footer .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
        }

        .footer img {
            height: 48px;
            filter: drop-shadow(0 2px 4px rgb(0 0 0 / 0.1));
        }

        .footer p {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 500;
        }

        /* Animations d'entrée */
        .fade-in {
            animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* États de chargement */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: #64748b;
        }

        .loading::after {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 0.5rem;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Dropdown de langue amélioré */
        #language-select {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: var(--card-light);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            min-width: 150px;
            z-index: 1000;
        }

        body.dark-mode #language-select {
            background: var(--card-dark);
            border-color: var(--border-dark);
        }

        #language-select option {
            padding: 0.75rem 1rem;
        }

        .language-dropdown {
            position: relative;
        }

        /* Responsive amélioré */
        @media (max-width: 1200px) {
            .indicators-grid {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            }

            .tooltip .tooltiptext {
                width: 300px;
            }
        }

        @media (max-width: 992px) {
            .app-container {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .sidebar {
                width: 100%;
                position: static;
                max-height: none;
                height: auto;
            }

            .indicator-list {
                max-height: 300px;
            }

            .dashboard-header {
                flex-direction: column;
                gap: 1.5rem;
                text-align: center;
            }

            .button-group {
                flex-wrap: wrap;
                justify-content: center;
            }

            .filter-panel {
                flex-direction: column;
                gap: 1rem;
            }

            .filter-group {
                min-width: 100%;
            }

            .tooltip .tooltiptext {
                width: 280px;
                position: absolute;
                left: 50%;
                transform: translateX(-50%) translateY(10px);
            }

            .tooltip:hover .tooltiptext {
                transform: translateX(-50%) translateY(0);
            }
        }

        @media (max-width: 768px) {
            .indicators-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 240px;
            }

            .dashboard-header h1 {
                font-size: 1.5rem;
            }

            .card {
                padding: 1rem;
            }

            .sidebar {
                padding: 1.5rem 1rem;
            }

            .tooltip .tooltiptext {
                width: 250px;
                font-size: 0.8rem;
                padding: 1rem;
            }
        }
    </style>
</head>

<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2 id="sidebar-title">Indicateurs de Santé</h2>
                <p class="sidebar-subtitle">Tableau de bord interactif</p>
            </div>
            <ul class="indicator-list" id="indicator-list">
                <li><button data-indicator="life_expectancy" class="active">
                        <i class="fas fa-heartbeat"></i>
                        <span id="indicator-life-expectancy">Espérance de vie</span>
                    </button></li>
                <li><button data-indicator="infant_mortality_rate">
                        <i class="fas fa-baby"></i>
                        <span id="indicator-infant-mortality-rate">Taux de mortalité infantile</span>
                    </button></li>
                <li><button data-indicator="adult_mortality_rate">
                        <i class="fas fa-user-md"></i>
                        <span id="indicator-adult-mortality-rate">Taux de mortalité adulte</span>
                    </button></li>
                <li><button data-indicator="SH.DYN.AIDS.ZS">
                        <i class="fas fa-virus"></i>
                        <span id="indicator-hiv-prevalence">Prévalence VIH (%)</span>
                    </button></li>
                <li><button data-indicator="SH.DYN.MORT">
                        <i class="fas fa-heartbeat"></i>
                        <span id="indicator-mortality-rate">Taux de mortalité</span>
                    </button></li>
                <li><button data-indicator="SH.H2O.SMDW.ZS">
                        <i class="fas fa-tint"></i>
                        <span id="indicator-water-access">Accès à l'eau potable sûre (%)</span>
                    </button></li>
                <li><button data-indicator="SH.IMM.MEAS">
                        <i class="fas fa-syringe"></i>
                        <span id="indicator-measles-vaccination">Vaccination rougeole (%)</span>
                    </button></li>
                <li><button data-indicator="SH.MED.BEDS.ZS">
                        <i class="fas fa-bed"></i>
                        <span id="indicator-hospital-beds">Lits d'hôpital (pour 1000)</span>
                    </button></li>
                <li><button data-indicator="SH.MED.PHYS.ZS">
                        <i class="fas fa-user-md"></i>
                        <span id="indicator-physicians">Médecins (pour 1000)</span>
                    </button></li>
                <li><button data-indicator="SH.STA.ACSN">
                        <i class="fas fa-shield-alt"></i>
                        <span id="indicator-health-access">Accès aux services de santé</span>
                    </button></li>
                <li><button data-indicator="SH.STA.ACSN.RU">
                        <i class="fas fa-shield-alt"></i>
                        <span id="indicator-health-access-rural">Accès aux services de santé (rural)</span>
                    </button></li>
                <li><button data-indicator="SH.STA.ACSN.UR">
                        <i class="fas fa-shield-alt"></i>
                        <span id="indicator-health-access-urban">Accès aux services de santé (urbain)</span>
                    </button></li>
                <li><button data-indicator="SH.STA.BRTC.ZS">
                        <i class="fas fa-birthday-cake"></i>
                        <span id="indicator-birth-rate">Taux de natalité (%)</span>
                    </button></li>
                <li><button data-indicator="SH.STA.MALN.ZS">
                        <i class="fas fa-utensils"></i>
                        <span id="indicator-malnutrition">Malnutrition (%)</span>
                    </button></li>
                <li><button data-indicator="SH.STA.STNT.ZS">
                        <i class="fas fa-child"></i>
                        <span id="indicator-stunting">Retard de croissance (%)</span>
                    </button></li>
                <li><button data-indicator="SH.STA.BASS.ZS">
                        <i class="fas fa-toilet"></i>
                        <span id="indicator-basic-sanitation">Accès à l'assainissement de base (%)</span>
                    </button></li>
                <li><button data-indicator="SH.STA.HYGN.ZS">
                        <i class="fas fa-hands-wash"></i>
                        <span id="indicator-hygiene">Accès à l'hygiène (%)</span>
                    </button></li>
                <li><button data-indicator="SH.STA.HYGN.RU">
                        <i class="fas fa-hands-wash"></i>
                        <span id="indicator-hygiene-rural">Accès à l'hygiène (rural) (%)</span>
                    </button></li>
                <li><button data-indicator="SH.STA.HYGN.UR">
                        <i class="fas fa-hands-wash"></i>
                        <span id="indicator-hygiene-urban">Accès à l'hygiène (urbain) (%)</span>
                    </button></li>
                <li><button data-indicator="SH.STA.WASH.ZS">
                        <i class="fas fa-shower"></i>
                        <span id="indicator-wash">Eau, assainissement et hygiène (%)</span>
                    </button></li>
            </ul>
        </aside>

        <main class="main-content">
            <header class="dashboard-header fade-in">
                <div>
                    <h1 id="dashboard-title">Tableau de bord des indicateurs de santé</h1>
                    <p id="dashboard-subtitle">Comparaison entre Maroc, Région MENA et Monde</p>
                </div>
                <div class="button-group">
                    <button class="action-button success" id="export-button" onclick="exportData()">
                        <i class="fas fa-file-export"></i>
                        <span>Exporter Excel</span>
                    </button>
                    <button class="action-button secondary" id="dark-mode-button" onclick="toggleDarkMode()">
                        <i class="fas fa-moon"></i>
                        <span>Mode Sombre</span>
                    </button>
                    <div class="language-dropdown">
                        <button class="action-button" id="language-button" onclick="toggleLanguageDropdown()">
                            <i class="fas fa-globe"></i>
                            <span>Langue</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <select id="language-select" onchange="changeLanguage()" style="display: none;">
                            <option value="fr">Français</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>
            </header>

            <div class="filter-panel fade-in">
                <div class="filter-group">
                    <label for="region-filter">Région</label>
                    <select id="region-filter" onchange="applyFilters()">
                        <option value="all">Toutes les régions</option>
                        <option value="morocco">Maroc</option>
                        <option value="mena">Région MENA</option>
                        <option value="world">Monde</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="year-filter">Année</label>
                    <select id="year-filter" onchange="applyFilters()">
                        <option value="all">Toutes les années</option>
                        <option value="2020">2020</option>
                        <option value="2021">2021</option>
                        <option value="2022">2022</option>
                        <option value="2023">2023</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="category-filter">Catégorie</label>
                    <select id="category-filter" onchange="applyFilters()">
                        <option value="all">Toutes</option>
                        <option value="mortality">Mortalité</option>
                        <option value="health-access">Accès à la santé</option>
                        <option value="hygiene">Hygiène et assainissement</option>
                        <option value="vaccination">Vaccination</option>
                        <option value="nutrition">Nutrition</option>
                    </select>
                </div>
            </div>

            <div class="indicators-grid" id="indicators-container"></div>
        </main>
    </div>

    <footer class="footer">
        <div class="container">
            <img src="https://decisiveai.ma/wp-content/uploads/2024/12/Logo-Decisive-AI-PNG.png" alt="Decisive AI Logo">
            <p>© 2025 DecisiveAI. Tous droits réservés.</p>
        </div>
    </footer>

    <script>
        // Variables globales
        let chartInstances = {};
        let currentData = {};
        let isDarkMode = false;
        let currentLanguage = 'fr';
        let selectedIndicator = 'life_expectancy';

        const indicatorTranslationKeys = {
            'life_expectancy': 'LifeExpectancy',
            'infant_mortality_rate': 'InfantMortalityRate',
            'adult_mortality_rate': 'AdultMortalityRate',
            'SH.DYN.AIDS.ZS': 'HIVPrevalence',
            'SH.DYN.MORT': 'MortalityRate',
            'SH.H2O.SMDW.ZS': 'WaterAccess',
            'SH.IMM.MEAS': 'MeaslesVaccination',
            'SH.MED.BEDS.ZS': 'HospitalBeds',
            'SH.MED.PHYS.ZS': 'Physicians',
            'SH.STA.ACSN': 'HealthAccess',
            'SH.STA.ACSN.RU': 'HealthAccessRural',
            'SH.STA.ACSN.UR': 'HealthAccessUrban',
            'SH.STA.BRTC.ZS': 'BirthRate',
            'SH.STA.MALN.ZS': 'Malnutrition',
            'SH.STA.STNT.ZS': 'Stunting',
            'SH.STA.BASS.ZS': 'BasicSanitation',
            'SH.STA.HYGN.ZS': 'Hygiene',
            'SH.STA.HYGN.RU': 'HygieneRural',
            'SH.STA.HYGN.UR': 'HygieneUrban',
            'SH.STA.WASH.ZS': 'Wash'
        };

        const translations = {
            en: {
                sidebarTitle: 'Health Indicators',
                indicatorLifeExpectancy: 'Life Expectancy',
                indicatorInfantMortalityRate: 'Infant Mortality Rate',
                indicatorAdultMortalityRate: 'Adult Mortality Rate',
                indicatorHIVPrevalence: 'HIV Prevalence (%)',
                indicatorMortalityRate: 'Mortality Rate',
                indicatorWaterAccess: 'Access to Safe Drinking Water (%)',
                indicatorMeaslesVaccination: 'Measles Vaccination (%)',
                indicatorHospitalBeds: 'Hospital Beds (per 1000)',
                indicatorPhysicians: 'Physicians (per 1000)',
                indicatorHealthAccess: 'Access to Health Services',
                indicatorHealthAccessRural: 'Access to Health Services (Rural)',
                indicatorHealthAccessUrban: 'Access to Health Services (Urban)',
                indicatorBirthRate: 'Birth Rate (%)',
                indicatorMalnutrition: 'Malnutrition (%)',
                indicatorStunting: 'Stunting (%)',
                indicatorBasicSanitation: 'Access to Basic Sanitation (%)',
                indicatorHygiene: 'Access to Hygiene (%)',
                indicatorHygieneRural: 'Access to Hygiene (Rural) (%)',
                indicatorHygieneUrban: 'Access to Hygiene (Urban) (%)',
                indicatorWash: 'Water, Sanitation, and Hygiene (%)',
                exportButton: 'Export to Excel',
                darkModeButton: 'Toggle Dark Mode',
                languageButton: 'Language',
                dashboardTitle: 'Health Indicators Dashboard',
                dashboardSubtitle: 'Comparison between Morocco, MENA Region, and World',
                chartTitle: 'Evolution of ',
                indicatorDefinitionError: 'Error loading data: ',
                exportAlert: 'No data to export.',
                yearLabel: 'Year',
                yAxisLabelLifeExpectancy: 'Life Expectancy (years)',
                yAxisLabelInfantMortalityRate: 'Rate (per 1000 births)',
                yAxisLabelAdultMortalityRate: 'Rate (per 1000)',
                yAxisLabelHIVPrevalence: 'Prevalence (%)',
                yAxisLabelMortalityRate: 'Rate (per 1000)',
                yAxisLabelWaterAccess: 'Access (%)',
                yAxisLabelMeaslesVaccination: 'Vaccination (%)',
                yAxisLabelHospitalBeds: 'Beds (per 1000)',
                yAxisLabelPhysicians: 'Physicians (per 1000)',
                yAxisLabelHealthAccess: 'Access (index)',
                yAxisLabelHealthAccessRural: 'Access (index)',
                yAxisLabelHealthAccessUrban: 'Access (index)',
                yAxisLabelBirthRate: 'Rate (%)',
                yAxisLabelMalnutrition: 'Prevalence (%)',
                yAxisLabelStunting: 'Prevalence (%)',
                yAxisLabelBasicSanitation: 'Access (%)',
                yAxisLabelHygiene: 'Access (%)',
                yAxisLabelHygieneRural: 'Access (%)',
                yAxisLabelHygieneUrban: 'Access (%)',
                yAxisLabelWash: 'Access (%)',
                definitionLifeExpectancy: 'Life expectancy at birth indicates the number of years a newborn would live if prevailing patterns of mortality at the time of birth were to stay the same throughout their life.',
                definitionInfantMortalityRate: 'Infant mortality rate is the number of infants dying before reaching one year of age, per 1,000 live births in a given year.',
                definitionAdultMortalityRate: 'Adult mortality rate is the probability of dying between the ages of 15 and 60, if subject to current age-specific mortality rates between those ages.',
                definitionHIVPrevalence: 'Prevalence of HIV refers to the percentage of people ages 15-49 who are infected with HIV.',
                definitionMortalityRate: 'Mortality rate is the number of deaths per 1,000 individuals per year in a given population.',
                definitionWaterAccess: 'Access to safe drinking water refers to the percentage of the population with access to safely managed drinking water services on premises, available when needed and free from contamination.',
                definitionMeaslesVaccination: 'Measles vaccination coverage refers to the percentage of children ages 12-23 months who received the measles vaccine before 12 months or at any time before the survey.',
                definitionHospitalBeds: 'Hospital beds include inpatient beds available in public, private, general, and specialized hospitals and rehabilitation centers, measured per 1,000 people.',
                definitionPhysicians: 'Physicians include generalist and specialist medical doctors, measured per 1,000 people.',
                definitionHealthAccess: 'Access to health services measures the coverage of essential health services based on tracer interventions that include reproductive, maternal, newborn and child health, infectious diseases, non-communicable diseases and service capacity and access.',
                definitionHealthAccessRural: 'Access to health services (rural) measures the coverage of essential health services in rural areas based on an index of tracer interventions.',
                definitionHealthAccessUrban: 'Access to health services (urban) measures the coverage of essential health services in urban areas based on an index of tracer interventions.',
                definitionBirthRate: 'Birth rate refers to the percentage of births attended by skilled health personnel (generally doctors, nurses, or midwives).',
                definitionMalnutrition: 'Malnutrition prevalence refers to the percentage of children under 5 whose weight for age is more than two standard deviations below the median for the international reference population.',
                definitionStunting: 'Stunting prevalence refers to the percentage of children under 5 whose height for age is more than two standard deviations below the median for the international reference population.',
                definitionBasicSanitation: 'Access to basic sanitation refers to the percentage of the population with access to improved sanitation facilities that are not shared with other households.',
                definitionHygiene: 'Access to hygiene refers to the percentage of the population with access to a handwashing facility with soap and water available on premises.',
                definitionHygieneRural: 'Access to hygiene (rural) refers to the percentage of the rural population with access to a handwashing facility with soap and water available on premises.',
                definitionHygieneUrban: 'Access to hygiene (urban) refers to the percentage of the urban population with access to a handwashing facility with soap and water available on premises.',
                definitionWash: 'Water, sanitation, and hygiene (WASH) refers to the percentage of the population with access to improved water, sanitation, and hygiene facilities.',
                categoryAll: 'All',
                categoryMortality: 'Mortality',
                categoryHealthAccess: 'Health Access',
                categoryHygiene: 'Hygiene & Sanitation',
                categoryVaccination: 'Vaccination',
                categoryNutrition: 'Nutrition'
            },
            fr: {
                sidebarTitle: 'Indicateurs de Santé',
                indicatorLifeExpectancy: 'Espérance de vie',
                indicatorInfantMortalityRate: 'Taux de mortalité infantile',
                indicatorAdultMortalityRate: 'Taux de mortalité adulte',
                indicatorHIVPrevalence: 'Prévalence VIH (%)',
                indicatorMortalityRate: 'Taux de mortalité',
                indicatorWaterAccess: 'Accès à l\'eau potable sûre (%)',
                indicatorMeaslesVaccination: 'Vaccination rougeole (%)',
                indicatorHospitalBeds: 'Lits d\'hôpital (pour 1000)',
                indicatorPhysicians: 'Médecins (pour 1000)',
                indicatorHealthAccess: 'Accès aux services de santé',
                indicatorHealthAccessRural: 'Accès aux services de santé (rural)',
                indicatorHealthAccessUrban: 'Accès aux services de santé (urbain)',
                indicatorBirthRate: 'Taux de natalité (%)',
                indicatorMalnutrition: 'Malnutrition (%)',
                indicatorStunting: 'Retard de croissance (%)',
                indicatorBasicSanitation: 'Accès à l\'assainissement de base (%)',
                indicatorHygiene: 'Accès à l\'hygiène (%)',
                indicatorHygieneRural: 'Accès à l\'hygiène (rural) (%)',
                indicatorHygieneUrban: 'Accès à l\'hygiène (urbain) (%)',
                indicatorWash: 'Eau, assainissement et hygiène (%)',
                exportButton: 'Exporter Excel',
                darkModeButton: 'Mode Sombre',
                languageButton: 'Langue',
                dashboardTitle: 'Tableau de bord des indicateurs de santé',
                dashboardSubtitle: 'Comparaison entre Maroc, Région MENA et Monde',
                chartTitle: 'Évolution de ',
                indicatorDefinitionError: 'Erreur lors du chargement des données : ',
                exportAlert: 'Aucune donnée à exporter.',
                yearLabel: 'Année',
                yAxisLabelLifeExpectancy: 'Espérance de vie (années)',
                yAxisLabelInfantMortalityRate: 'Taux (pour 1000 naissances)',
                yAxisLabelAdultMortalityRate: 'Taux (pour 1000)',
                yAxisLabelHIVPrevalence: 'Prévalence (%)',
                yAxisLabelMortalityRate: 'Taux (pour 1000)',
                yAxisLabelWaterAccess: 'Accès (%)',
                yAxisLabelMeaslesVaccination: 'Vaccination (%)',
                yAxisLabelHospitalBeds: 'Lits (pour 1000)',
                yAxisLabelPhysicians: 'Médecins (pour 1000)',
                yAxisLabelHealthAccess: 'Accès (index)',
                yAxisLabelHealthAccessRural: 'Accès (index)',
                yAxisLabelHealthAccessUrban: 'Accès (index)',
                yAxisLabelBirthRate: 'Taux (%)',
                yAxisLabelMalnutrition: 'Prévalence (%)',
                yAxisLabelStunting: 'Prévalence (%)',
                yAxisLabelBasicSanitation: 'Accès (%)',
                yAxisLabelHygiene: 'Accès (%)',
                yAxisLabelHygieneRural: 'Accès (%)',
                yAxisLabelHygieneUrban: 'Accès (%)',
                yAxisLabelWash: 'Accès (%)',
                definitionLifeExpectancy: 'L\'espérance de vie à la naissance indique le nombre d\'années qu\'un nouveau-né vivrait si les modèles de mortalité actuels au moment de la naissance restaient les mêmes tout au long de sa vie.',
                definitionInfantMortalityRate: 'Le taux de mortalité infantile est le nombre de nourrissons décédant avant d\'atteindre un an, pour 1 000 naissances vivantes dans une année donnée.',
                definitionAdultMortalityRate: 'Le taux de mortalité adulte est la probabilité de mourir entre 15 et 60 ans, si soumis aux taux de mortalité actuels spécifiques à l\'âge entre ces âges.',
                definitionHIVPrevalence: 'La prévalence du VIH désigne le pourcentage de personnes âgées de 15 à 49 ans infectées par le VIH.',
                definitionMortalityRate: 'Le taux de mortalité est le nombre de décès pour 1 000 individus par an dans une population donnée.',
                definitionWaterAccess: 'L\'accès à l\'eau potable sûre désigne le pourcentage de la population ayant accès à des services d\'eau potable gérés en toute sécurité sur place, disponibles quand nécessaire et exempts de contamination.',
                definitionMeaslesVaccination: 'La couverture vaccinale contre la rougeole désigne le pourcentage d\'enfants âgés de 12 à 23 mois ayant reçu le vaccin contre la rougeole avant 12 mois ou à tout moment avant l\'enquête.',
                definitionHospitalBeds: 'Les lits d\'hôpital incluent les lits pour patients hospitalisés disponibles dans les hôpitaux publics, privés, généraux et spécialisés et les centres de réadaptation, mesurés pour 1 000 personnes.',
                definitionPhysicians: 'Les médecins incluent les généralistes et spécialistes, mesurés pour 1 000 personnes.',
                definitionHealthAccess: 'L\'accès aux services de santé mesure la couverture des services de santé essentiels basée sur des interventions traceurs qui incluent la santé reproductive, maternelle, néonatale et infantile, les maladies infectieuses, les maladies non transmissibles et la capacité et l\'accès aux services.',
                definitionHealthAccessRural: 'L\'accès aux services de santé (rural) mesure la couverture des services de santé essentiels dans les zones rurales basée sur un indice d\'interventions traceurs.',
                definitionHealthAccessUrban: 'L\'accès aux services de santé (urbain) mesure la couverture des services de santé essentiels dans les zones urbaines basée sur un indice d\'interventions traceurs.',
                definitionBirthRate: 'Le taux de natalité désigne le pourcentage de naissances assistées par du personnel de santé qualifié (généralement médecins, infirmières ou sages-femmes).',
                definitionMalnutrition: 'La prévalence de la malnutrition désigne le pourcentage d\'enfants de moins de 5 ans dont le poids par rapport à l\'âge est de plus de deux écarts-types en dessous de la médiane de la population de référence internationale.',
                definitionStunting: 'La prévalence du retard de croissance désigne le pourcentage d\'enfants de moins de 5 ans dont la taille par rapport à l\'âge est de plus de deux écarts-types en dessous de la médiane de la population de référence internationale.',
                definitionBasicSanitation: 'L\'accès à l\'assainissement de base désigne le pourcentage de la population ayant accès à des installations d\'assainissement améliorées qui ne sont pas partagées avec d\'autres ménages.',
                definitionHygiene: 'L\'accès à l\'hygiène désigne le pourcentage de la population ayant accès à une installation de lavage des mains avec du savon et de l\'eau disponibles sur place.',
                definitionHygieneRural: 'L\'accès à l\'hygiène (rural) désigne le pourcentage de la population rurale ayant accès à une installation de lavage des mains avec du savon et de l\'eau disponibles sur place.',
                definitionHygieneUrban: 'L\'accès à l\'hygiène (urbain) désigne le pourcentage de la population urbaine ayant accès à une installation de lavage des mains avec du savon et de l\'eau disponibles sur place.',
                definitionWash: 'L\'eau, l\'assainissement et l\'hygiène (WASH) désignent le pourcentage de la population ayant accès à des installations améliorées d\'eau, d\'assainissement et d\'hygiène.',
                categoryAll: 'Toutes',
                categoryMortality: 'Mortalité',
                categoryHealthAccess: 'Accès à la santé',
                categoryHygiene: 'Hygiène et assainissement',
                categoryVaccination: 'Vaccination',
                categoryNutrition: 'Nutrition'
            }
        };

        // Configuration des indicateurs avec les vrais fichiers
        const indicators = {
            'life_expectancy': { file: 'API_SP.DYN.LE00.MA.IN_DS2_en_excel_v2_86009.xls', icon: 'fas fa-heartbeat', category: 'mortality' },
            'infant_mortality_rate': { file: 'API_SP.DYN.CDRT.IN_DS2_en_excel_v2_85364.xls', icon: 'fas fa-baby', category: 'mortality' },
            'adult_mortality_rate': { file: 'API_SP.DYN.AMRT.MA_DS2_en_excel_v2_85977.xls', icon: 'fas fa-user-md', category: 'mortality' },
            'SH.DYN.AIDS.ZS': { file: 'SH.DYN.AIDS.ZS.xlsx', icon: 'fas fa-virus', category: 'mortality' },
            'SH.DYN.MORT': { file: 'SH.DYN.MORT.xlsx', icon: 'fas fa-heartbeat', category: 'mortality' },
            'SH.H2O.SMDW.ZS': { file: 'SH.H2O.SAFE.ZS.xlsx', icon: 'fas fa-tint', category: 'hygiene' },
            'SH.IMM.MEAS': { file: 'H.IMM.MEAS.xlsx', icon: 'fas fa-syringe', category: 'vaccination' },
            'SH.MED.BEDS.ZS': { file: 'SH.MED.BEDS.ZS.xlsx', icon: 'fas fa-bed', category: 'health-access' },
            'SH.MED.PHYS.ZS': { file: 'SH.MED.PHYS.ZS.xlsx', icon: 'fas fa-user-md', category: 'health-access' },
            'SH.STA.ACSN': { file: 'SH.STA.ACSN.xlsx', icon: 'fas fa-shield-alt', category: 'health-access' },
            'SH.STA.ACSN.RU': { file: 'SH.STA.ACSN.RU.xlsx', icon: 'fas fa-shield-alt', category: 'health-access' },
            'SH.STA.ACSN.UR': { file: 'SH.STA.ACSN.UR.xlsx', icon: 'fas fa-shield-alt', category: 'health-access' },
            'SH.STA.BRTC.ZS': { file: 'SH.STA.BRTC.ZS.xlsx', icon: 'fas fa-birthday-cake', category: 'mortality' },
            'SH.STA.MALN.ZS': { file: 'SH.STA.MALN.ZS.xlsx', icon: 'fas fa-utensils', category: 'nutrition' },
            'SH.STA.STNT.ZS': { file: 'SH.STA.MMRT.xlsx', icon: 'fas fa-child', category: 'nutrition' },
            'SH.STA.BASS.ZS': { file: 'SH.TBS.INCD.xlsx', icon: 'fas fa-toilet', category: 'hygiene' },
            'SH.STA.HYGN.ZS': { file: 'SH.XPD.CHEX.GD.ZS.xlsx', icon: 'fas fa-hands-wash', category: 'hygiene' },
            'SH.STA.HYGN.RU': { file: 'SH.XPD.CHEX.PC.CD.xlsx', icon: 'fas fa-hands-wash', category: 'hygiene' },
            'SH.STA.HYGN.UR': { file: 'SP.ADO.TFRT.xlsx', icon: 'fas fa-hands-wash', category: 'hygiene' },
            'SH.STA.WASH.ZS': { file: 'SP.DYN.IMRT.IN.xlsx', icon: 'fas fa-shower', category: 'hygiene' }
        };

        // Fonction pour positionner le tooltip dynamiquement


        function toggleLanguageDropdown() {
            const dropdown = document.getElementById('language-select');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        function changeLanguage() {
            currentLanguage = document.getElementById('language-select').value;
            updateLanguage();
            Object.keys(indicators).forEach(indicatorKey => {
                if (currentData[indicatorKey]) {
                    updateChart(indicatorKey, currentData[indicatorKey].years, currentData[indicatorKey].marocData, currentData[indicatorKey].menaData, currentData[indicatorKey].worldData, indicators[indicatorKey]);
                }
            });
            const categoryFilter = document.getElementById('category-filter');
            const t = translations[currentLanguage];
            categoryFilter.innerHTML = `
                <option value="all">${t.categoryAll}</option>
                <option value="mortality">${t.categoryMortality}</option>
                <option value="health-access">${t.categoryHealthAccess}</option>
                <option value="hygiene">${t.categoryHygiene}</option>
                <option value="vaccination">${t.categoryVaccination}</option>
                <option value="nutrition">${t.categoryNutrition}</option>
            `;
        }

        function updateLanguage() {
            const t = translations[currentLanguage];
            document.getElementById('sidebar-title').textContent = t.sidebarTitle;
            document.getElementById('indicator-life-expectancy').textContent = t.indicatorLifeExpectancy;
            document.getElementById('indicator-infant-mortality-rate').textContent = t.indicatorInfantMortalityRate;
            document.getElementById('indicator-adult-mortality-rate').textContent = t.indicatorAdultMortalityRate;
            document.getElementById('indicator-hiv-prevalence').textContent = t.indicatorHIVPrevalence;
            document.getElementById('indicator-mortality-rate').textContent = t.indicatorMortalityRate;
            document.getElementById('indicator-water-access').textContent = t.indicatorWaterAccess;
            document.getElementById('indicator-measles-vaccination').textContent = t.indicatorMeaslesVaccination;
            document.getElementById('indicator-hospital-beds').textContent = t.indicatorHospitalBeds;
            document.getElementById('indicator-physicians').textContent = t.indicatorPhysicians;
            document.getElementById('indicator-health-access').textContent = t.indicatorHealthAccess;
            document.getElementById('indicator-health-access-rural').textContent = t.indicatorHealthAccessRural;
            document.getElementById('indicator-health-access-urban').textContent = t.indicatorHealthAccessUrban;
            document.getElementById('indicator-birth-rate').textContent = t.indicatorBirthRate;
            document.getElementById('indicator-malnutrition').textContent = t.indicatorMalnutrition;
            document.getElementById('indicator-stunting').textContent = t.indicatorStunting;
            document.getElementById('indicator-basic-sanitation').textContent = t.indicatorBasicSanitation;
            document.getElementById('indicator-hygiene').textContent = t.indicatorHygiene;
            document.getElementById('indicator-hygiene-rural').textContent = t.indicatorHygieneRural;
            document.getElementById('indicator-hygiene-urban').textContent = t.indicatorHygieneUrban;
            document.getElementById('indicator-wash').textContent = t.indicatorWash;
            document.getElementById('export-button').querySelector('span').textContent = t.exportButton;
            document.getElementById('dark-mode-button').querySelector('span').textContent = t.darkModeButton;
            document.getElementById('language-button').querySelector('span').textContent = t.languageButton;
            document.getElementById('dashboard-title').textContent = t.dashboardTitle;
            document.getElementById('dashboard-subtitle').textContent = t.dashboardSubtitle;

            Object.keys(indicators).forEach(indicatorKey => {
                const card = document.getElementById(`card-${indicatorKey}`);
                if (card) {
                    const title = card.querySelector('h2');
                    title.textContent = t[`indicator${indicatorTranslationKeys[indicatorKey]}`];
                    const tooltip = document.getElementById(`tooltip-${indicatorKey}`);
                    if (tooltip) tooltip.textContent = t[`definition${indicatorTranslationKeys[indicatorKey]}`];
                }
            });
        }

        // Fonction pour mettre à jour l'indicateur sélectionné
        function updateSelectedIndicator(indicatorKey) {
            selectedIndicator = indicatorKey;

            // Mettre à jour les classes des cartes
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('selected');
            });

            const selectedCard = document.getElementById(`card-${indicatorKey}`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }
        }

        // Fonction de chargement des données avec les vrais fichiers
        async function loadIndicatorData(indicatorKey) {
            const indicator = indicators[indicatorKey];
            const container = document.getElementById('indicators-container');

            if (!document.getElementById(`card-${indicatorKey}`)) {
                const card = document.createElement('div');
                card.className = `card fade-in ${indicatorKey === selectedIndicator ? 'selected' : ''}`;
                card.id = `card-${indicatorKey}`;
                card.innerHTML = `
                    <div class="card-header">
                        <div class="tooltip">
                            <h2>${translations[currentLanguage][`indicator${indicatorTranslationKeys[indicatorKey]}`]}</h2>
                            <span class="tooltiptext" id="tooltip-${indicatorKey}">${translations[currentLanguage][`definition${indicatorTranslationKeys[indicatorKey]}`]}</span>
                        </div>
                        <div class="card-icon">
                            <i class="${indicator.icon}"></i>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div class="loading">Chargement des données...</div>
                    </div>
                    <div class="source-info" id="source-${indicatorKey}">Source: Chargement... | Mise à jour: Chargement...</div>
                `;
                container.appendChild(card);

                // Supprimer ces lignes :

            }

            try {
                const response = await fetch(indicator.file);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                const dataSheet = workbook.Sheets['Data'];
                const dataJson = XLSX.utils.sheet_to_json(dataSheet);

                const menaCountries = ['DZA', 'BHR', 'EGY', 'IRN', 'IRQ', 'JOR', 'KWT', 'LBN', 'LBY', 'MAR', 'OMN', 'QAT', 'SAU', 'SYR', 'TUN', 'ARE', 'PSE', 'YEM'];
                const firstRow = dataJson[0] || {};
                const yearColumns = Object.keys(firstRow).filter(key => /^\d{4}$/.test(key)).sort();
                const years = yearColumns.slice(-4);

                let marocData = [], menaData = [], worldData = [];

                const marocRow = dataJson.find(row => row['Country Code'] === 'MAR');
                if (marocRow) {
                    years.forEach(year => {
                        marocData.push(marocRow[year] ? parseFloat(marocRow[year]).toFixed(2) : null);
                    });
                    document.getElementById(`source-${indicatorKey}`).textContent = `Source: Indicateurs de Développement Mondial | Mise à jour: 15/04/2025`;
                } else {
                    document.getElementById(`source-${indicatorKey}`).textContent = `Source: N/A | Mise à jour: N/A`;
                }

                const worldRow = dataJson.find(row => row['Country Code'] === 'WLD');
                if (worldRow) {
                    years.forEach(year => {
                        worldData.push(worldRow[year] ? parseFloat(worldRow[year]).toFixed(2) : null);
                    });
                }

                years.forEach(year => {
                    let sum = 0, count = 0;
                    menaCountries.forEach(country => {
                        const row = dataJson.find(row => row['Country Code'] === country);
                        if (row && row[year] && !isNaN(parseFloat(row[year]))) {
                            sum += parseFloat(row[year]);
                            count++;
                        }
                    });
                    menaData.push(count > 0 ? parseFloat((sum / count).toFixed(2)) : null);
                });

                currentData[indicatorKey] = { years, marocData, menaData, worldData };
                updateChart(indicatorKey, years, marocData, menaData, worldData, indicator);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById(`source-${indicatorKey}`).textContent = `Source: Erreur | Mise à jour: N/A`;
                const card = document.getElementById(`card-${indicatorKey}`);
                if (card) {
                    const chartContainer = card.querySelector('.chart-container');
                    chartContainer.innerHTML = `<p style="text-align: center; color: #ef4444; padding: 2rem;">${translations[currentLanguage].indicatorDefinitionError}${error.message}</p>`;
                }
            }
        }

        function updateChart(indicatorKey, years, marocData, menaData, worldData, indicator) {
            const chartContainer = document.getElementById(`card-${indicatorKey}`).querySelector('.chart-container');
            chartContainer.innerHTML = '<canvas id="chart-' + indicatorKey + '"></canvas>';

            const ctx = document.getElementById(`chart-${indicatorKey}`).getContext('2d');
            if (chartInstances[indicatorKey]) chartInstances[indicatorKey].destroy();

            const regionFilter = document.getElementById('region-filter').value;
            const yearFilter = document.getElementById('year-filter').value;
            const categoryFilter = document.getElementById('category-filter').value;

            if (categoryFilter !== 'all' && indicator.category !== categoryFilter) {
                document.getElementById(`card-${indicatorKey}`).style.display = 'none';
                return;
            }

            document.getElementById(`card-${indicatorKey}`).style.display = 'block';

            const datasets = [];
            if (regionFilter === 'all' || regionFilter === 'morocco') datasets.push({
                label: currentLanguage === 'fr' ? 'Maroc' : 'Morocco',
                data: marocData,
                borderColor: '#667eea',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointRadius: 6,
                pointBackgroundColor: '#667eea',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 3
            });
            if (regionFilter === 'all' || regionFilter === 'mena') datasets.push({
                label: currentLanguage === 'fr' ? 'Région MENA' : 'MENA Region',
                data: menaData,
                borderColor: '#f5576c',
                backgroundColor: 'rgba(245, 87, 108, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointRadius: 6,
                pointBackgroundColor: '#f5576c',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 3
            });
            if (regionFilter === 'all' || regionFilter === 'world') datasets.push({
                label: currentLanguage === 'fr' ? 'Monde' : 'World',
                data: worldData,
                borderColor: '#4facfe',
                backgroundColor: 'rgba(79, 172, 254, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointRadius: 6,
                pointBackgroundColor: '#4facfe',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 3
            });

            let filteredYears = years;
            let filteredData = datasets.map(dataset => ({ ...dataset, data: dataset.data.slice() }));

            if (yearFilter !== 'all') {
                const yearIndex = years.indexOf(yearFilter);
                filteredYears = [yearFilter];
                filteredData = datasets.map(dataset => ({
                    ...dataset,
                    data: [dataset.data[yearIndex]]
                }));
            }

            chartInstances[indicatorKey] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: filteredYears,
                    datasets: filteredData
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: translations[currentLanguage].chartTitle + translations[currentLanguage][`indicator${indicatorTranslationKeys[indicatorKey]}`],
                            align: 'center',
                            font: { size: 14, weight: '600' },
                            color: isDarkMode ? '#f1f5f9' : '#1e293b',
                            padding: { top: 15, bottom: 15 }
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 11, weight: '500' },
                                color: isDarkMode ? '#f1f5f9' : '#1e293b',
                                padding: 15,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleFont: { size: 12, weight: '600' },
                            bodyFont: { size: 11 },
                            padding: 12,
                            cornerRadius: 8,
                            usePointStyle: true,
                            callbacks: {
                                label: context => `${context.dataset.label}: ${context.parsed.y ? context.parsed.y.toFixed(2) : 'N/A'}`
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: translations[currentLanguage][`yAxisLabel${indicatorTranslationKeys[indicatorKey]}`],
                                font: { size: 11, weight: '500' },
                                color: isDarkMode ? '#f1f5f9' : '#1e293b'
                            },
                            grid: {
                                color: isDarkMode ? 'rgba(241, 245, 249, 0.1)' : 'rgba(30, 41, 59, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: isDarkMode ? '#94a3b8' : '#64748b',
                                font: { size: 10 },
                                callback: value => value ? value.toFixed(1) : 'N/A'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: translations[currentLanguage].yearLabel,
                                font: { size: 11, weight: '500' },
                                color: isDarkMode ? '#f1f5f9' : '#1e293b'
                            },
                            grid: { display: false },
                            ticks: {
                                color: isDarkMode ? '#94a3b8' : '#64748b',
                                font: { size: 10, weight: '500' }
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        function applyFilters() {
            Object.keys(indicators).forEach(indicatorKey => {
                if (currentData[indicatorKey]) {
                    const { years, marocData, menaData, worldData } = currentData[indicatorKey];
                    updateChart(indicatorKey, years, marocData, menaData, worldData, indicators[indicatorKey]);
                }
            });
        }

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode');

            // Mettre à jour l'icône du bouton
            const darkModeIcon = document.getElementById('dark-mode-button').querySelector('i');
            darkModeIcon.className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';

            Object.values(chartInstances).forEach(chart => {
                chart.options.scales.x.ticks.color = isDarkMode ? '#94a3b8' : '#64748b';
                chart.options.scales.y.ticks.color = isDarkMode ? '#94a3b8' : '#64748b';
                chart.options.plugins.legend.labels.color = isDarkMode ? '#f1f5f9' : '#1e293b';
                chart.options.scales.y.title.color = isDarkMode ? '#f1f5f9' : '#1e293b';
                chart.options.scales.x.title.color = isDarkMode ? '#f1f5f9' : '#1e293b';
                chart.options.plugins.title.color = isDarkMode ? '#f1f5f9' : '#1e293b';
                chart.options.scales.y.grid.color = isDarkMode ? 'rgba(241, 245, 249, 0.1)' : 'rgba(30, 41, 59, 0.1)';
                chart.update();
            });
        }

        function exportData() {
            if (!Object.keys(currentData).length) {
                alert(translations[currentLanguage].exportAlert);
                return;
            }
            const wb = XLSX.utils.book_new();
            Object.keys(currentData).forEach(indicatorKey => {
                const data = currentData[indicatorKey];
                const wsData = data.years.map((year, index) => ({
                    [translations[currentLanguage].yearLabel]: year,
                    [currentLanguage === 'fr' ? 'Maroc' : 'Morocco']: data.marocData[index] || null,
                    [currentLanguage === 'fr' ? 'Région MENA' : 'MENA Region']: data.menaData[index] || null,
                    [currentLanguage === 'fr' ? 'Monde' : 'World']: data.worldData[index] || null
                }));
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(wsData), translations[currentLanguage][`indicator${indicatorTranslationKeys[indicatorKey]}`]);
            });
            XLSX.writeFile(wb, `indicateurs_sante_${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        // Event listeners pour les boutons d'indicateurs - CORRIGÉ
        document.querySelectorAll('.indicator-list li button').forEach(button => {
            button.addEventListener('click', () => {
                // Mettre à jour les boutons actifs
                document.querySelectorAll('.indicator-list button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                const indicatorKey = button.getAttribute('data-indicator');

                // Mettre à jour l'indicateur sélectionné
                updateSelectedIndicator(indicatorKey);

                const card = document.getElementById(`card-${indicatorKey}`);
                if (card) {
                    card.classList.add('highlight');
                    card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    setTimeout(() => {
                        card.classList.remove('highlight');
                    }, 2000);
                }
            });
        });

        // Fermer le dropdown de langue en cliquant ailleurs
        document.addEventListener('click', (event) => {
            const languageDropdown = document.querySelector('.language-dropdown');
            const languageSelect = document.getElementById('language-select');
            if (!languageDropdown.contains(event.target)) {
                languageSelect.style.display = 'none';
            }
        });

        // Supprimer cette section :


        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            // Charger les données pour tous les indicateurs
            Object.keys(indicators).forEach((indicatorKey, index) => {
                setTimeout(() => {
                    loadIndicatorData(indicatorKey);
                }, index * 200); // Délai progressif pour un effet visuel
            });

            updateLanguage();

            // Animation d'entrée progressive pour les cartes
            setTimeout(() => {
                const cards = document.querySelectorAll('.card');
                cards.forEach((card, index) => {
                    card.style.animationDelay = `${index * 0.1}s`;
                });
            }, 500);
        });
    </script>
</body>

</html>